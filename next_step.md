# Blueprint êµ¬í˜„ ì™„ì„±ì„ ìœ„í•œ ìµœì¢… ë¶„ì„ ë° ìˆ˜ì • ê³„íš (next_step.md - v3)

## 1. ê°œìš”

ì´ ë¬¸ì„œëŠ” `blueprint.md` v11 ì•„í‚¤í…ì²˜ì˜ 6ëŒ€ í•µì‹¬ ì›ì¹™ì„ ê¸°ì¤€ìœ¼ë¡œ ì „ì²´ ì½”ë“œë² ì´ìŠ¤ë¥¼ ìƒì„¸íˆ ë¶„ì„í•œ ìµœì¢… ê²°ê³¼ë¬¼ì…ë‹ˆë‹¤. ëª¨ë“  í•µì‹¬ ì»´í¬ë„ŒíŠ¸ë¥¼ ì§ì ‘ ê²€í† í•œ ê²°ê³¼, ì„¤ê³„ ì² í•™ì€ ëª…í™•í•˜ê³  êµ¬í˜„ì˜ ë°©í–¥ì„±ì€ ì˜¬ë°”ë¥´ì§€ë§Œ, **blueprintì™€ ì‹¤ì œ êµ¬í˜„ ê°„ì˜ ì¤‘ìš”í•œ ë¶ˆì¼ì¹˜**ì™€ **êµ¬í˜„ ëˆ„ë½ ì‚¬í•­**ë“¤ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.

ì´ ë¬¸ì„œëŠ” ì‹œìŠ¤í…œì„ blueprintì˜ ì² í•™ê³¼ 100% ì¼ì¹˜ì‹œí‚¤ê¸° ìœ„í•œ êµ¬ì²´ì ì´ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ ìˆ˜ì • ê³„íšì„ ì œê³µí•©ë‹ˆë‹¤.

---

## 2. í•µì‹¬ ë¶ˆì¼ì¹˜ ë¶„ì„ ë° ìˆ˜ì • ì „ëµ

### ğŸ”´ **ìµœìš°ì„  ìˆ˜ì •ì‚¬í•­ 1: `Augmenter`ì˜ ì±…ì„ ë¶„ë¦¬ ìœ„ë°˜**

#### ë¬¸ì œì  ë¶„ì„:
- **ìœ„ì¹˜:** `src/core/augmenter.py:88-98`
- **êµ¬ì²´ì  ë¬¸ì œ:**
  ```python
  def _augment_batch(self, data: pd.DataFrame, context_params: ...):
      factory = Factory(self.settings)  # âŒ ì˜ëª»ëœ ì˜ì¡´ì„±
      adapter = factory.create_data_adapter('bq')  # âŒ ë°ì´í„° ë¡œë”© ì±…ì„ ì¹¨ë²”
      feature_df = adapter.read(self.source_uri, params=context_params)  # âŒ ì§ì ‘ ë°ì´í„° ë¡œë”©
  ```
- **Blueprint ì›ì¹™ ìœ„ë°˜:** 
  - **ì›ì¹™ 2 (í†µí•© ë°ì´í„° ì–´ëŒ‘í„°):** ë°ì´í„° ë¡œë”©ì€ íŒŒì´í”„ë¼ì¸ì˜ ì±…ì„ì´ë©°, AugmenterëŠ” ìˆœìˆ˜í•˜ê²Œ ì¦ê°• ë¡œì§ë§Œ ë‹´ë‹¹í•´ì•¼ í•¨
  - **ì›ì¹™ 5 (ë‹¨ì¼ Augmenter, ì»¨í…ìŠ¤íŠ¸ ì£¼ì…):** AugmenterëŠ” ì£¼ì…ë°›ì€ ë°ì´í„°ë¥¼ ë³€í™˜í•˜ëŠ” ì—­í• ë§Œ í•´ì•¼ í•¨

#### ìˆ˜ì • ì „ëµ:
1. **`_augment_batch` ë©”ì„œë“œ ì™„ì „ ì¬êµ¬í˜„:**
   - ë°ì´í„° ì–´ëŒ‘í„° ìƒì„± ë¡œì§ ì™„ì „ ì œê±°
   - ì…ë ¥ë°›ì€ `data` (PK ëª©ë¡)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ BigQueryì—ì„œ í”¼ì²˜ ì¡°íšŒí•˜ëŠ” ë¡œì§ë§Œ ìœ ì§€
   - ì‹¤ì œ BigQuery ì ‘ê·¼ì€ ì™¸ë¶€ì—ì„œ ì£¼ì…ë°›ì€ ì–´ëŒ‘í„°ë¥¼ í†µí•´ ìˆ˜í–‰

### ğŸ”´ **ìµœìš°ì„  ìˆ˜ì •ì‚¬í•­ 2: ë°ì´í„° ì–´ëŒ‘í„° í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ëˆ„ë½**

#### ë¬¸ì œì  ë¶„ì„:
- **ìœ„ì¹˜:** `src/utils/data_adapters/bigquery_adapter.py:17`, `gcs_adapter.py:15`, `s3_adapter.py:8`
- **êµ¬ì²´ì  ë¬¸ì œ:**
  ```python
  class BigQueryAdapter(BaseDataAdapter):
      def __init__(self, settings: Settings):
          super().__init__(settings)
          # âŒ self.client ì´ˆê¸°í™” ëˆ„ë½
  ```
- **ì˜í–¥:** ëª¨ë“  ë°ì´í„° ì–´ëŒ‘í„°ì—ì„œ `self.client` ì†ì„±ì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•„ ëŸ°íƒ€ì„ ì—ëŸ¬ ë°œìƒ

#### ìˆ˜ì • ì „ëµ:
1. **ëª¨ë“  ë°ì´í„° ì–´ëŒ‘í„°ì—ì„œ `__init__` ë©”ì„œë“œ ìˆ˜ì •:**
   ```python
   def __init__(self, settings: Settings):
       super().__init__(settings)
       self.client = self._get_client()
   ```

### ğŸ”´ **ìµœìš°ì„  ìˆ˜ì •ì‚¬í•­ 3: `Trainer`ì˜ Augmenter í˜¸ì¶œ ì‹œ ë§¤ê°œë³€ìˆ˜ ëˆ„ë½**

#### ë¬¸ì œì  ë¶„ì„:
- **ìœ„ì¹˜:** `src/core/trainer.py:43-44`
- **êµ¬ì²´ì  ë¬¸ì œ:**
  ```python
  train_df = augmenter.augment(train_df, context_params)  # âŒ run_mode ëˆ„ë½
  test_df = augmenter.augment(test_df, context_params)    # âŒ run_mode ëˆ„ë½
  ```
- **Blueprint ì›ì¹™ ìœ„ë°˜:** 
  - **ì›ì¹™ 5 (ë‹¨ì¼ Augmenter, ì»¨í…ìŠ¤íŠ¸ ì£¼ì…):** AugmenterëŠ” `run_mode`ë¥¼ ë°›ì•„ ë™ì‘ì„ ê²°ì •í•´ì•¼ í•¨

#### ìˆ˜ì • ì „ëµ:
1. **Trainerì—ì„œ Augmenter í˜¸ì¶œ ì‹œ `run_mode="batch"` ëª…ì‹œ:**
   ```python
   train_df = augmenter.augment(train_df, run_mode="batch", context_params=context_params)
   test_df = augmenter.augment(test_df, run_mode="batch", context_params=context_params)
   ```

### ğŸ”´ **ìµœìš°ì„  ìˆ˜ì •ì‚¬í•­ 4: API ì„œë¹™ì—ì„œ ì˜ëª»ëœ SQL ìŠ¤ëƒ…ìƒ· ì°¸ì¡°**

#### ë¬¸ì œì  ë¶„ì„:
- **ìœ„ì¹˜:** `serving/api.py:41`
- **êµ¬ì²´ì  ë¬¸ì œ:**
  ```python
  pk_fields = get_pk_from_loader_sql(app_context.model.sql_snapshot)  # âŒ ì˜ëª»ëœ ì†ì„±ëª…
  ```
- **ì‹¤ì œ ì†ì„±ëª…:** `augmenter_sql_snapshot`

#### ìˆ˜ì • ì „ëµ:
1. **ì˜¬ë°”ë¥¸ ì†ì„±ëª…ìœ¼ë¡œ ìˆ˜ì •:**
   ```python
   pk_fields = get_pk_from_loader_sql(app_context.model.augmenter_sql_snapshot)
   ```

### ğŸ”´ **ìµœìš°ì„  ìˆ˜ì •ì‚¬í•­ 5: RedisAdapter í˜¸ì¶œ ì‹œ ì˜ëª»ëœ ë§¤ê°œë³€ìˆ˜**

#### ë¬¸ì œì  ë¶„ì„:
- **ìœ„ì¹˜:** `src/core/augmenter.py:104`
- **êµ¬ì²´ì  ë¬¸ì œ:**
  ```python
  redis_adapter = factory.create_redis_adapter(feature_store_config)  # âŒ ì˜ëª»ëœ ë§¤ê°œë³€ìˆ˜
  ```
- **ì‹¤ì œ ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜:** `create_redis_adapter()`ëŠ” ë§¤ê°œë³€ìˆ˜ë¥¼ ë°›ì§€ ì•ŠìŒ

#### ìˆ˜ì • ì „ëµ:
1. **ì˜¬ë°”ë¥¸ í˜¸ì¶œ ë°©ì‹ìœ¼ë¡œ ìˆ˜ì •:**
   ```python
   redis_adapter = factory.create_redis_adapter()
   ```

### ğŸŸ¡ **S3Adapter ë¯¸ì™„ì„± êµ¬í˜„**

#### ë¬¸ì œì  ë¶„ì„:
- **ìœ„ì¹˜:** `src/utils/data_adapters/s3_adapter.py`
- **êµ¬ì²´ì  ë¬¸ì œ:** `__init__` ë©”ì„œë“œì—ì„œ `settings` ë°›ì§€ ì•Šê³  `_get_client` ë¯¸êµ¬í˜„

#### ìˆ˜ì • ì „ëµ:
1. **ë‹¤ë¥¸ í´ë¼ìš°ë“œ ì–´ëŒ‘í„°ì™€ ì¼ê´€ì„± ìˆê²Œ êµ¬í˜„:**
   ```python
   def __init__(self, settings: Settings):
       super().__init__(settings)
       self.client = self._get_client()
   
   def _get_client(self):
       # boto3 í´ë¼ì´ì–¸íŠ¸ ìƒì„± ë¡œì§ êµ¬í˜„
   ```

---

## 3. ë°ì´í„° íë¦„ ì •í™•ì„± ê²€ì¦

### âœ… **ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„ëœ ë¶€ë¶„ë“¤**

1. **`inference_pipeline.py`ì˜ ë°ì´í„° íë¦„:**
   - âœ… `wrapper.loader_uri`ì—ì„œ PK ë°ì´í„° ë¡œë“œ
   - âœ… ë¡œë“œëœ ë°ì´í„°ë¥¼ `wrapper.predict(input_df)`ë¡œ ì „ë‹¬
   - âœ… ì´ëŠ” blueprintì˜ ì„¤ê³„ ì˜ë„ì™€ ì™„ë²½íˆ ì¼ì¹˜

2. **`PyfuncWrapper.predict`ì˜ ë™ì‘:**
   - âœ… `model_input`ì„ `augmenter.augment`ì— ì „ë‹¬
   - âœ… `run_mode`ì— ë”°ë¥¸ ì¡°ê±´ë¶€ ì²˜ë¦¬
   - âœ… ìˆœìˆ˜ ë¡œì§ ì•„í‹°íŒ©íŠ¸ ì² í•™ ì¤€ìˆ˜

3. **Factory íŒ¨í„´ êµ¬í˜„:**
   - âœ… URI ìŠ¤í‚´ ê¸°ë°˜ ë™ì  ì–´ëŒ‘í„° ìƒì„±
   - âœ… ì„¤ì • ì£¼ì…ì„ í†µí•œ ì»´í¬ë„ŒíŠ¸ ìƒì„±

---

## 4. ìµœì¢… ìˆ˜ì • ê³„íš (ìš°ì„ ìˆœìœ„ë³„)

### **Phase 1: í•µì‹¬ ì•„í‚¤í…ì²˜ ìˆ˜ì • (ìµœìš°ì„ )**

1. **`src/core/augmenter.py` ìˆ˜ì •:**
   - `_augment_batch`ì—ì„œ Factory ìƒì„± ë¡œì§ ì œê±°
   - ë°ì´í„° ì–´ëŒ‘í„° ì§ì ‘ í˜¸ì¶œ ë¡œì§ ì œê±°
   - BigQuery í”¼ì²˜ ì¡°íšŒ ë¡œì§ì„ ì™¸ë¶€ ì–´ëŒ‘í„° í™œìš© ë°©ì‹ìœ¼ë¡œ ë³€ê²½

2. **`src/core/trainer.py` ìˆ˜ì •:**
   - Augmenter í˜¸ì¶œ ì‹œ `run_mode="batch"` ë§¤ê°œë³€ìˆ˜ ì¶”ê°€

3. **ëª¨ë“  ë°ì´í„° ì–´ëŒ‘í„° `__init__` ë©”ì„œë“œ ìˆ˜ì •:**
   - `BigQueryAdapter`, `GCSAdapter`, `S3Adapter`ì—ì„œ `self.client` ì´ˆê¸°í™” ì¶”ê°€

### **Phase 2: API ì„œë¹™ ìˆ˜ì • (ë†’ìŒ)**

1. **`serving/api.py` ìˆ˜ì •:**
   - `sql_snapshot` â†’ `augmenter_sql_snapshot` ë³€ê²½

2. **`src/core/augmenter.py` ìˆ˜ì •:**
   - RedisAdapter í˜¸ì¶œ ì‹œ ë§¤ê°œë³€ìˆ˜ ì œê±°

### **Phase 3: ë¯¸ì™„ì„± êµ¬í˜„ ì™„ë£Œ (ë³´í†µ)**

1. **`src/utils/data_adapters/s3_adapter.py` ì™„ì„±:**
   - `__init__` ë©”ì„œë“œì—ì„œ settings ë°›ë„ë¡ ìˆ˜ì •
   - `_get_client` ë©”ì„œë“œ êµ¬í˜„

### **Phase 4: í…ŒìŠ¤íŠ¸ ì½”ë“œ ì „ë©´ ìˆ˜ì • (ë‚®ìŒ)**

1. **`tests/` ë””ë ‰í† ë¦¬ ì „ì²´ ìˆ˜ì •:**
   - ìƒˆë¡œìš´ ì•„í‚¤í…ì²˜ì— ë§ì¶˜ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì¬ì‘ì„±
   - ê° ë°ì´í„° ì–´ëŒ‘í„°ë³„ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì¶”ê°€
   - í†µí•© í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ êµ¬í˜„

---

## 5. ìˆ˜ì • í›„ ê²€ì¦ ê³„íš

### **ë‹¨ê³„ë³„ ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸**

1. **Phase 1 ì™„ë£Œ í›„:**
   - [ ] `python main.py train --model-name "xgboost_x_learner"` ì •ìƒ ì‹¤í–‰
   - [ ] Augmenterê°€ ë°ì´í„° ì–´ëŒ‘í„°ë¥¼ ì§ì ‘ ìƒì„±í•˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸
   - [ ] ëª¨ë“  ë°ì´í„° ì–´ëŒ‘í„°ì˜ í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” í™•ì¸

2. **Phase 2 ì™„ë£Œ í›„:**
   - [ ] `python main.py serve-api` ì •ìƒ ì‹¤í–‰
   - [ ] API ìŠ¤í‚¤ë§ˆ ë™ì  ìƒì„± í™•ì¸
   - [ ] `/predict` ì—”ë“œí¬ì¸íŠ¸ ì •ìƒ ë™ì‘ í™•ì¸

3. **Phase 3 ì™„ë£Œ í›„:**
   - [ ] S3 í™˜ê²½ì—ì„œ ë°ì´í„° ì½ê¸°/ì“°ê¸° í…ŒìŠ¤íŠ¸
   - [ ] ëª¨ë“  í´ë¼ìš°ë“œ ì–´ëŒ‘í„°ì˜ ì¼ê´€ì„± í™•ì¸

4. **Phase 4 ì™„ë£Œ í›„:**
   - [ ] ì „ì²´ í…ŒìŠ¤íŠ¸ ìŠˆíŠ¸ ì‹¤í–‰
   - [ ] ì»¤ë²„ë¦¬ì§€ 80% ì´ìƒ ë‹¬ì„±

---

## 6. ê²°ë¡ 

í˜„ì¬ ì½”ë“œë² ì´ìŠ¤ëŠ” **blueprint.md**ì˜ ì² í•™ì„ ì´í•´í•˜ê³  ì˜¬ë°”ë¥¸ ë°©í–¥ìœ¼ë¡œ êµ¬í˜„ë˜ì–´ ìˆì§€ë§Œ, ìœ„ì—ì„œ ì‹ë³„í•œ **5ê°œì˜ í•µì‹¬ ë¶ˆì¼ì¹˜**ì™€ **ë¯¸ì™„ì„± êµ¬í˜„**ë“¤ì´ ì‹œìŠ¤í…œì˜ ì•ˆì •ì„±ê³¼ ì¼ê´€ì„±ì„ ì €í•´í•˜ê³  ìˆìŠµë‹ˆë‹¤.

íŠ¹íˆ **Augmenterì˜ ì±…ì„ ë¶„ë¦¬ ìœ„ë°˜**ê³¼ **ë°ì´í„° ì–´ëŒ‘í„° í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ëˆ„ë½**ì€ ì‹œìŠ¤í…œì˜ í•µì‹¬ ì•„í‚¤í…ì²˜ì— ì˜í–¥ì„ ë¯¸ì¹˜ë¯€ë¡œ ìµœìš°ì„ ìœ¼ë¡œ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.

ì´ ê³„íšì„ ë‹¨ê³„ì ìœ¼ë¡œ ì‹¤í–‰í•˜ë©´ blueprintì˜ 6ëŒ€ í•µì‹¬ ì›ì¹™ì„ ì™„ë²½íˆ êµ¬í˜„í•œ production-ready ì‹œìŠ¤í…œì„ êµ¬ì¶•í•  ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.