# config/base.yaml: ëª¨ë“  í™˜ê²½ì˜ ê³µí†µ ê¸°ë°˜ì´ì ë¡œì»¬ ê°œë°œì˜ ê¸°ë³¸ê°’
# -----------------------------------------------------------------------------
# ì´ íŒŒì¼ì€ ëª¨ë“  í™˜ê²½(local, dev, prod)ì—ì„œ ê³µí†µì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ê¸°ë³¸ ì„¤ì •ì„ ì •ì˜í•©ë‹ˆë‹¤.
# APP_ENV í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš°, ì´ íŒŒì¼ì˜ ì„¤ì •ì´ ìµœì¢…ì ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.
# ë”°ë¼ì„œ, ë¡œì»¬ ê°œë°œì— ê°€ì¥ ì•ˆì „í•˜ê³  ë³´ìˆ˜ì ì¸ ê°’ì„ ì„¤ì •í•˜ëŠ” ê²ƒì„ ì›ì¹™ìœ¼ë¡œ í•©ë‹ˆë‹¤.
# -----------------------------------------------------------------------------

# 1. ì‹¤í–‰ í™˜ê²½
environment:
  # ê¸°ë³¸ ì‹¤í–‰ í™˜ê²½ì€ 'local'ì…ë‹ˆë‹¤.
  # Docker ë¹Œë“œ ì‹œ ë˜ëŠ” ì„œë²„ í™˜ê²½ì—ì„œ APP_ENV í™˜ê²½ ë³€ìˆ˜ë¥¼ ì£¼ì…í•˜ì—¬ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  app_env: ${APP_ENV:local}
  # ë¡œì»¬ ê°œë°œ ì‹œì—ëŠ” ì´ ê°’ì„ ì‚¬ìš©í•˜ê±°ë‚˜, .env íŒŒì¼ì—ì„œ ë®ì–´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  gcp_project_id: "local-project"
  gcp_credential_path: ${GCP_CREDENTIAL_PATH:./credentials/local_gcp_credentials.json}

# 2. ëª¨ë¸ ì•„í‹°íŒ©íŠ¸ ìŠ¤í† ì–´ (MLflow Model Registry)
mlflow:
  # LOCAL í™˜ê²½ì—ì„œëŠ” íŒŒì¼ ì‹œìŠ¤í…œ ê¸°ë°˜ MLflow ì‚¬ìš©
  tracking_uri: ${MLFLOW_TRACKING_URI:./mlruns}
  # ëª¨ë“  ì‹¤í—˜ì˜ í†µí•© ëª©ì ì„ ëª…í™•íˆ ì •ì˜
  experiment_name: "Campaign-Uplift-Modeling"

# 3. API ì„œë²„ ìš´ì˜ í™˜ê²½
serving:
  # API ì„œë²„ ì‹¤í–‰ ì‹œ, ê¸°ë³¸ì ìœ¼ë¡œ 'Staging' ìŠ¤í…Œì´ì§€ì˜ ëª¨ë¸ì„ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.
  # í”„ë¡œë•ì…˜ì—ì„œëŠ” config.prod.yamlì—ì„œ ì´ ê°’ì„ "Production"ìœ¼ë¡œ ë®ì–´ì”ë‹ˆë‹¤.
  model_stage: ${MODEL_STAGE:Staging}
  # ì‹¤ì‹œê°„ í”¼ì²˜ ìŠ¤í† ì–´ ì„¤ì • (ë¡œì»¬ ê°œë°œìš©)
  realtime_feature_store:
    store_type: "redis"
    connection:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      db: 0

# 4. ë°ì´í„°ì…‹ ì•„í‹°íŒ©íŠ¸ ìŠ¤í† ì–´ (ì¤‘ê°„/ìµœì¢… ì‚°ì¶œë¬¼ ì €ì¥ ìœ„ì¹˜)
artifact_stores:
  # í”¼ì²˜ ì¦ê°• ë°ì´í„°ì…‹ ì €ì¥ì†Œ
  augmented_dataset:
    enabled: true
    # ë¡œì»¬ í™˜ê²½ì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í”„ë¡œì íŠ¸ ë‚´ ë””ë ‰í† ë¦¬ì— íŒŒì¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.
    base_uri: "file://local/artifacts/augmented"
  
  # ì „ì²˜ë¦¬ ì™„ë£Œ ë°ì´í„°ì…‹ ì €ì¥ì†Œ
  preprocessed_dataset:
    enabled: false # ë””ë²„ê¹… ì‹œì—ë§Œ trueë¡œ ë³€ê²½í•˜ì—¬ ì‚¬ìš©
    base_uri: "file://local/artifacts/preprocessed"
  
  # ìµœì¢… ì˜ˆì¸¡ ê²°ê³¼ ì €ì¥ì†Œ
  prediction_results:
    enabled: true
    base_uri: "file://local/artifacts/predictions"

# ğŸ†• 5. í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹ (ìƒˆë¡œ ì¶”ê°€ - ê¸°ë³¸ê°’: ë¹„í™œì„±í™”)
hyperparameter_tuning:
  enabled: false  # ê¸°ë³¸ê°’: ê¸°ì¡´ ë™ì‘ ìœ ì§€ (ê³ ì • hyperparameters)
  engine: "optuna"
  timeout: 1800  # 30ë¶„ (ì¸í”„ë¼ ì œì•½)
  pruning:
    enabled: true
    algorithm: "MedianPruner"
    n_startup_trials: 5
    n_warmup_steps: 10
  parallelization:
    n_jobs: 1  # ê¸°ë³¸ê°’: ë‹¨ì¼ ì½”ì–´

# ï¿½ï¿½ 6. Feature Store (Blueprint v17.0: config í†µí•©)
feature_store:
  provider: "dynamic"  # runtimeì—ì„œ ê²°ì •
  
  # ğŸ¯ Blueprint ì›ì¹™ 1 ì¤€ìˆ˜: ë¡œì»¬ í™˜ê²½ ê¸°ë³¸ ì„¤ì •
  # LOCAL í™˜ê²½ì˜ ê¸°ë³¸ê°’ (data/ ë””ë ‰í† ë¦¬ ê¸°ë°˜)
  feast_config:
    project: "ml_pipeline_local"
    provider: "local"
    
    # Registry (ë¡œì»¬ íŒŒì¼ ê¸°ë°˜)
    registry: "data/feature_store/registry.sqlite"
    
    # Offline Store (ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œ)
    offline_store:
      type: "file"
      path: "data/feature_store/offline"
    
    # Online Store (ë¡œì»¬ SQLite)
    online_store:
      type: "sqlite"
      path: "data/feature_store/online.sqlite"
    
    # ê¸°ë³¸ ì—”í‹°í‹° ì •ì˜
    entities:
      - name: "user"
        value_type: "STRING"
        description: "ì‚¬ìš©ì ì‹ë³„ì"
      - name: "product"
        value_type: "STRING"
        description: "ìƒí’ˆ ì‹ë³„ì"
      - name: "session"
        value_type: "STRING"
        description: "ì„¸ì…˜ ì‹ë³„ì"
    
    # ì„¤ì • í”Œë˜ê·¸
    entity_key_serialization_version: 2
    flags:
      alpha_features: true
      beta_features: false  # ë¡œì»¬ì—ì„œëŠ” ì•ˆì •ì„± ìš°ì„ 
    
    # ë°°ì¹˜ ì—”ì§„
    batch_engine:
      type: "local"
    
    # Feature Server (ë¡œì»¬ì—ì„œëŠ” ë¹„í™œì„±í™”)
    feature_server:
      enabled: false
  
  # ì—°ê²° ì •ë³´ (í•˜ìœ„ í˜¸í™˜ì„±)
  connection_timeout: 5000
  retry_attempts: 3
  connection_info:
    # í™˜ê²½ë³„ë¡œ config/*.yamlì—ì„œ ì£¼ì…
    redis_host: ${FEATURE_STORE_REDIS_HOST:localhost:6379}
    offline_store_uri: ${FEATURE_STORE_OFFLINE_URI:file://data/feature_store/offline}

# 7. ë°ì´í„° ì–´ëŒ‘í„° ì„¤ì • (Blueprint v17.0: Config-driven Dynamic Factory)
data_adapters:
  # LOCAL í™˜ê²½ ê¸°ë³¸ ì–´ëŒ‘í„° ë§¤í•‘
  default_loader: "filesystem"
  default_storage: "filesystem"
  default_feature_store: "filesystem"
  
  # ì–´ëŒ‘í„°ë³„ êµ¬ì²´ì  ì„¤ì •
  adapters:
    filesystem:
      class_name: "FileSystemAdapter"
      config:
        base_path: "./data"
        supported_formats: ["parquet", "csv", "json"]
        auto_create_dirs: true
    
    postgresql:
      class_name: "PostgreSQLAdapter"
      config:
        host: "${DB_HOST:localhost}"
        port: "${DB_PORT:5432}"
        database: "${DB_NAME:mlpipeline}"
        user: "${DB_USER:mluser}"
        password: "${DB_PASSWORD:mlpassword}"
        schema: "${DB_SCHEMA:public}"
        pool_size: 5
        max_overflow: 10
        echo_sql: false
    
    bigquery:
      class_name: "BigQueryAdapter"
      config:
        project_id: "${GCP_PROJECT_ID}"
        dataset_id: "${BQ_DATASET:ml_pipeline}"
        location: "${BQ_LOCATION:us-central1}"
        credentials_path: "${GOOGLE_APPLICATION_CREDENTIALS}"
        use_legacy_sql: false
        use_query_cache: true
        maximum_bytes_billed: 1073741824  # 1GB limit
    
    redis:
      class_name: "RedisAdapter"
      config:
        host: "${REDIS_HOST:localhost}"
        port: "${REDIS_PORT:6379}"
        db: "${REDIS_DB:0}"
        password: "${REDIS_PASSWORD:}"
        decode_responses: true
        socket_timeout: 5
        connection_pool_max_connections: 50
    
    gcs:
      class_name: "GCSAdapter"
      config:
        bucket: "${GCS_BUCKET:ml-pipeline-data}"
        prefix: "${GCS_PREFIX:data/}"
        credentials_path: "${GOOGLE_APPLICATION_CREDENTIALS}"
        chunk_size: 8388608  # 8MB
        max_retry_delay: 60
    
    s3:
      class_name: "S3Adapter"
      config:
        bucket: "${S3_BUCKET:ml-pipeline-data}"
        prefix: "${S3_PREFIX:data/}"
        region: "${AWS_REGION:us-east-1}"
        access_key_id: "${AWS_ACCESS_KEY_ID}"
        secret_access_key: "${AWS_SECRET_ACCESS_KEY}"
        endpoint_url: "${S3_ENDPOINT_URL:}"
