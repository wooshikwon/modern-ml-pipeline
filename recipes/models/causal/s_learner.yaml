# S-Learner: Single Learner Approach for Causal Inference
# ğŸ“Š Treatmentì™€ Controlì„ í•˜ë‚˜ì˜ ëª¨ë¸ë¡œ í•™ìŠµí•˜ëŠ” ê°„ë‹¨í•˜ë©´ì„œë„ ê°•ë ¥í•œ ì ‘ê·¼ë²•

name: "s_learner"

model:
  # CausalML S-Learner ì§ì ‘ ë™ì  import
  class_path: "causalml.inference.meta.SLearner"
  
  # Phase 1: Point-in-Time ì •í•©ì„± ìŠ¤í‚¤ë§ˆ
  loader:
    name: "ad_impact_analysis_loader"
    source_uri: "recipes/sql/loaders/ad_campaign_effectiveness.sql"
    adapter: sql
    entity_schema:
      entity_columns: ["user_id"]
      timestamp_column: "conversion_date"
  
  # ê¸°ì¡´: ML ì‘ì—…ë³„ ì„¸ë¶€ ì„¤ì • (Causal ì „ìš©)
  data_interface:
    task_type: "causal"
    target_column: "purchase_amount"           # êµ¬ë§¤ ê¸ˆì•¡ (ì—°ì†í˜•)
    treatment_column: "promotion_received"     # í”„ë¡œëª¨ì…˜ ìˆ˜ì‹  ì—¬ë¶€ (0/1)
    treatment_value: 1                         # Treatment ê·¸ë£¹ (í”„ë¡œëª¨ì…˜ ë°›ì€ ê²½ìš°)
    
  # Dictionary í˜•íƒœ í•˜ì´í¼íŒŒë¼ë¯¸í„° (S-Learner íŠ¹í™”)
  hyperparameters:
    # Base learnerë¡œ Random Forest ì‚¬ìš©
    base_learner: "random_forest"
    
    # Random Forest í•˜ì´í¼íŒŒë¼ë¯¸í„° ìë™ ìµœì í™”
    n_estimators: {type: "int", low: 50, high: 500}
    max_depth: {type: "int", low: 3, high: 20}
    min_samples_split: {type: "int", low: 2, high: 20}
    min_samples_leaf: {type: "int", low: 1, high: 10}
    max_features: {type: "categorical", choices: ["sqrt", "log2", "auto"]}
    
    # ê³ ì •ê°’ - ì¬í˜„ì„±ê³¼ ì„±ëŠ¥ì„ ìœ„í•œ ì„¤ì •
    random_state: 42
    n_jobs: -1

  # í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹ ì„¤ì • (Causal ë©”íŠ¸ë¦­ ìµœì í™”)
  hyperparameter_tuning:
    enabled: true
    n_trials: 80                    # ì¶©ë¶„í•œ íƒìƒ‰ì„ ìœ„í•œ trial ìˆ˜
    metric: "uplift_auc"           # Uplift AUCë¡œ ìµœì í™”
    direction: "maximize"
  
  # Feature Store ê¸°ë°˜ í”¼ì²˜ ì¦ê°•
  augmenter:
    type: "feature_store"
    features:
      # ì‚¬ìš©ì ì¸êµ¬í†µê³„í•™ì  ì •ë³´
      - feature_namespace: "user_demographics"
        features: ["age", "gender", "income_bracket", "location_tier"]
      
      # ì‚¬ìš©ì ê³¼ê±° êµ¬ë§¤ í–‰ë™
      - feature_namespace: "user_purchase_history"
        features: ["total_purchases_30d", "avg_purchase_amount", "favorite_category"]
      
      # íŒë§¤ì ì •ë³´
      - feature_namespace: "merchant_profile"
        features: ["merchant_category", "merchant_rating", "promotion_frequency"]
      
      # ê±°ë˜ ì»¨í…ìŠ¤íŠ¸
      - feature_namespace: "transaction_context"
        features: ["day_of_week", "hour_of_day", "is_weekend", "season"]

  # ì „ì²˜ë¦¬ ì„¤ì • (Causal inference íŠ¹í™”)
  preprocessor:
    name: "causal_preprocessor"
    params:
      criterion_col: null
      # Entity í‚¤, timestamp, target, treatmentëŠ” ì „ì²˜ë¦¬ì—ì„œ ì œì™¸
      exclude_cols: ["user_id", "merchant_id", "transaction_timestamp", "purchase_amount", "promotion_received"]
      # Causal inferenceë¥¼ ìœ„í•œ íŠ¹ë³„ ì„¤ì •
      handle_missing: "median"      # ê²°ì¸¡ì¹˜ ì²˜ë¦¬
      scale_features: true          # í”¼ì²˜ ìŠ¤ì¼€ì¼ë§
      encode_categorical: "onehot"  # ë²”ì£¼í˜• ì¸ì½”ë”©

  # í‰ê°€ì ì„¤ì •
  evaluator:
    name: "causal_evaluator"

# í‰ê°€ ì„¤ì • (Causal inference íŠ¹í™” ë©”íŠ¸ë¦­)
evaluation:
  metrics:
    - "uplift_auc"        # Uplift modelingì˜ í•µì‹¬ ë©”íŠ¸ë¦­
    - "uplift_at_k"       # ìƒìœ„ k%ì—ì„œì˜ uplift
    - "qini_coefficient"  # Qini curve ê¸°ë°˜ í‰ê°€
    - "treatment_effect"  # í‰ê·  treatment effect
  
  validation:
    method: "train_test_split"
    test_size: 0.2
    stratify: true        # Treatment ê·¸ë£¹ ë¹„ìœ¨ ìœ ì§€
    random_state: 42
