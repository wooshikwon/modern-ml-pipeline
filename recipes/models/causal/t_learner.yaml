# T-Learner: Two-Model Approach for Causal Inference
# ğŸ“Š Treatmentì™€ Controlì„ ë³„ë„ ëª¨ë¸ë¡œ í•™ìŠµí•˜ëŠ” ì •ë°€í•œ ì ‘ê·¼ë²•

name: "t_learner"

model:
  # CausalML T-Learner ì§ì ‘ ë™ì  import
  class_path: "causalml.inference.meta.TLearner"
  
  # Phase 1: Point-in-Time ì •í•©ì„± ìŠ¤í‚¤ë§ˆ
  loader:
    name: "treatment_effect_loader"
    source_uri: "recipes/sql/loaders/medical_treatment_effects.sql"
    adapter: sql
    entity_schema:
      entity_columns: ["patient_id"]
      timestamp_column: "treatment_date"
  
  # ê¸°ì¡´: ML ì‘ì—…ë³„ ì„¸ë¶€ ì„¤ì • (Causal ì „ìš©)
  data_interface:
    task_type: "causal"
    target_column: "conversion_value"        # ì „í™˜ ê°€ì¹˜ (ì—°ì†í˜•)
    treatment_column: "received_campaign"    # ìº í˜ì¸ ìˆ˜ì‹  ì—¬ë¶€ (0/1)
    treatment_value: 1                       # Treatment ê·¸ë£¹ (ìº í˜ì¸ ë°›ì€ ê²½ìš°)
    
  # Dictionary í˜•íƒœ í•˜ì´í¼íŒŒë¼ë¯¸í„° (T-Learner íŠ¹í™”)
  hyperparameters:
    # Base learnerë¡œ XGBoost ì‚¬ìš© (T-LearnerëŠ” ë” ë³µì¡í•œ ëª¨ë¸ ì„ í˜¸)
    base_learner: "xgboost"
    
    # XGBoost í•˜ì´í¼íŒŒë¼ë¯¸í„° ìë™ ìµœì í™”
    n_estimators: {type: "int", low: 100, high: 1000}
    learning_rate: {type: "float", low: 0.01, high: 0.3, log: true}
    max_depth: {type: "int", low: 3, high: 15}
    subsample: {type: "float", low: 0.6, high: 1.0}
    colsample_bytree: {type: "float", low: 0.6, high: 1.0}
    
    # ê³ ì •ê°’ - ì¬í˜„ì„±ê³¼ ì„±ëŠ¥ì„ ìœ„í•œ ì„¤ì •
    random_state: 42
    n_jobs: -1
    verbosity: 0

  # í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹ ì„¤ì •
  hyperparameter_tuning:
    enabled: true
    n_trials: 60                    # T-LearnerëŠ” 2ê°œ ëª¨ë¸ì„ í•™ìŠµí•˜ë¯€ë¡œ ì ë‹¹íˆ
    metric: "uplift_auc"           # Uplift AUCë¡œ ìµœì í™”
    direction: "maximize"
  
  # Feature Store ê¸°ë°˜ í”¼ì²˜ ì¦ê°•
  augmenter:
    type: "feature_store"
    features:
      # ê³ ê° í”„ë¡œí•„
      - feature_namespace: "customer_profile"
        features: ["age_group", "income_level", "subscription_tier", "geographic_region"]
      
      # ê³¼ê±° ìº í˜ì¸ ë°˜ì‘
      - feature_namespace: "campaign_history"
        features: ["previous_conversions", "avg_response_time", "preferred_channel"]
      
      # ì œí’ˆ ê´€ì‹¬ë„
      - feature_namespace: "product_affinity"
        features: ["category_preferences", "price_sensitivity", "brand_loyalty"]
      
      # í–‰ë™ íŒ¨í„´
      - feature_namespace: "behavioral_signals"
        features: ["website_activity", "email_engagement", "social_interaction"]

  # ì „ì²˜ë¦¬ ì„¤ì •
  preprocessor:
    name: "causal_preprocessor"
    params:
      criterion_col: null
      exclude_cols: ["customer_id", "campaign_id", "campaign_launch_date", "conversion_value", "received_campaign"]
      handle_missing: "median"
      scale_features: true
      encode_categorical: "onehot"

  # í‰ê°€ì ì„¤ì •
  evaluator:
    name: "causal_evaluator"

# í‰ê°€ ì„¤ì •
evaluation:
  metrics:
    - "uplift_auc"
    - "uplift_at_k"
    - "qini_coefficient"
    - "treatment_effect"
  
  validation:
    method: "train_test_split"
    test_size: 0.2
    stratify: true
    random_state: 42
