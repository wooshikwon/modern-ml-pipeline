# XGBoost T-Learner: High-Performance Causal Inference
# ğŸš€ XGBoostì˜ ê°•ë ¥í•¨ê³¼ T-Learnerì˜ ì •ë°€í•¨ì„ ê²°í•©

name: "xgb_t_learner"

model:
  # CausalML XGBoost T-Learner ì§ì ‘ ë™ì  import
  class_path: "causalml.inference.meta.XGBTRegressor"
  
  # Phase 1: Point-in-Time ì •í•©ì„± ìŠ¤í‚¤ë§ˆ
  loader:
    name: "product_recommendation_loader"
    source_uri: "recipes/sql/loaders/recommendation_features.sql"
    entity_schema:
      entity_columns: ["user_id", "product_id"]    # ì‚¬ìš©ì-ì œí’ˆ í˜ì–´
      timestamp_column: "interaction_timestamp"    # ìƒí˜¸ì‘ìš© ì‹œì 
  
  # ê¸°ì¡´: ML ì‘ì—…ë³„ ì„¸ë¶€ ì„¤ì • (Causal ì „ìš©)
  data_interface:
    task_type: "causal"
    target_column: "engagement_score"       # ì°¸ì—¬ë„ ì ìˆ˜ (ì—°ì†í˜•)
    treatment_column: "personalized_rec"    # ê°œì¸í™” ì¶”ì²œ ì—¬ë¶€ (0/1)
    treatment_value: 1                      # Treatment ê·¸ë£¹ (ê°œì¸í™” ë°›ì€ ê²½ìš°)
    
  # Dictionary í˜•íƒœ í•˜ì´í¼íŒŒë¼ë¯¸í„° (XGBoost T-Learner íŠ¹í™”)
  hyperparameters:
    # XGBoost í•µì‹¬ í•˜ì´í¼íŒŒë¼ë¯¸í„°
    n_estimators: {type: "int", low: 100, high: 1500}
    learning_rate: {type: "float", low: 0.01, high: 0.3, log: true}
    max_depth: {type: "int", low: 3, high: 12}
    
    # ì •ê·œí™” íŒŒë¼ë¯¸í„°
    reg_alpha: {type: "float", low: 0, high: 1}      # L1 ì •ê·œí™”
    reg_lambda: {type: "float", low: 1, high: 10}    # L2 ì •ê·œí™”
    
    # ìƒ˜í”Œë§ íŒŒë¼ë¯¸í„°
    subsample: {type: "float", low: 0.6, high: 1.0}
    colsample_bytree: {type: "float", low: 0.6, high: 1.0}
    colsample_bylevel: {type: "float", low: 0.6, high: 1.0}
    
    # ê³ ì •ê°’
    random_state: 42
    n_jobs: -1
    verbosity: 0

  # í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹ ì„¤ì •
  hyperparameter_tuning:
    enabled: true
    n_trials: 100                   # XGBoostëŠ” ë³µì¡í•˜ë¯€ë¡œ ë” ë§ì€ trial
    metric: "uplift_auc"
    direction: "maximize"
  
  # Feature Store ê¸°ë°˜ í”¼ì²˜ ì¦ê°•
  augmenter:
    type: "feature_store"
    features:
      # ì‚¬ìš©ì í–‰ë™ íŒ¨í„´
      - feature_namespace: "user_behavior"
        features: ["browse_history", "purchase_frequency", "session_duration", "click_through_rate"]
      
      # ì œí’ˆ íŠ¹ì„±
      - feature_namespace: "product_attributes"
        features: ["category", "price_range", "popularity_score", "review_rating"]
      
      # ìƒí˜¸ì‘ìš© ì»¨í…ìŠ¤íŠ¸
      - feature_namespace: "interaction_context"
        features: ["time_of_day", "device_type", "referral_source", "page_context"]
      
      # ì¶”ì²œ ì‹œìŠ¤í…œ ë©”íƒ€ë°ì´í„°
      - feature_namespace: "recommendation_meta"
        features: ["algorithm_version", "confidence_score", "diversity_score"]

  # ì „ì²˜ë¦¬ ì„¤ì •
  preprocessor:
    name: "causal_preprocessor"
    params:
      criterion_col: null
      exclude_cols: ["user_id", "product_id", "interaction_timestamp", "engagement_score", "personalized_rec"]
      handle_missing: "median"
      scale_features: false        # XGBoostëŠ” ìŠ¤ì¼€ì¼ë§ ë¶ˆí•„ìš”
      encode_categorical: "label"   # Label encoding for XGBoost

  # í‰ê°€ì ì„¤ì •
  evaluator:
    name: "causal_evaluator"

# í‰ê°€ ì„¤ì •
evaluation:
  metrics:
    - "uplift_auc"
    - "uplift_at_k"
    - "qini_coefficient"
    - "treatment_effect"
  
  validation:
    method: "train_test_split"
    test_size: 0.2
    stratify: true
    random_state: 42
