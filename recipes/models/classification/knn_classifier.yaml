# KNN Classifier: ë‹¨ìˆœí•¨ ì†ì˜ ì§€í˜œ
# ğŸ¯ ìµœê·¼ì ‘ ì´ì›ƒì˜ í˜ìœ¼ë¡œ ì§€ì—­ì  íŒ¨í„´ì„ ì™„ë²½í•˜ê²Œ í¬ì°©

name: "knn_classifier"

model:
  # Scikit-learn KNN Classifier ì§ì ‘ ë™ì  import
  class_path: "sklearn.neighbors.KNeighborsClassifier"
  
  # Phase 1: Point-in-Time ì •í•©ì„± ìŠ¤í‚¤ë§ˆ
  loader:
    name: "wine_quality_loader"
    source_uri: "data/wine_quality.csv"
    adapter: storage
    entity_schema:
      entity_columns: ["fixed_acidity", "volatile_acidity", "citric_acid", "residual_sugar", "chlorides", "free_sulfur_dioxide", "total_sulfur_dioxide", "density", "pH", "sulphates", "alcohol"]
      timestamp_column: "timestamp"
  
  # ê¸°ì¡´: ML ì‘ì—…ë³„ ì„¸ë¶€ ì„¤ì • (Classification ì „ìš©)
  data_interface:
    task_type: "classification"
    target_column: "user_preference"     # ì‚¬ìš©ì ì„ í˜¸ë„ (ì¢‹ì•„ìš”/ì‹«ì–´ìš”/ì¤‘ë¦½)
    class_weight: "balanced"             # ë‹¤ì¤‘ í´ë˜ìŠ¤ ê· í˜•
    average: "weighted"
    
  # Dictionary í˜•íƒœ í•˜ì´í¼íŒŒë¼ë¯¸í„° (KNN íŠ¹í™”)
  hyperparameters:
    # ì´ì›ƒ ìˆ˜ (KNNì˜ í•µì‹¬)
    n_neighbors: {type: "int", low: 3, high: 50}
    
    # ê±°ë¦¬ ê³„ì‚° ë°©ë²•
    metric: {type: "categorical", choices: ["euclidean", "manhattan", "minkowski", "cosine"]}
    
    # ê°€ì¤‘ì¹˜ ë°©ë²•
    weights: {type: "categorical", choices: ["uniform", "distance"]}
    
    # Minkowski ê±°ë¦¬ íŒŒë¼ë¯¸í„°
    p: {type: "int", low: 1, high: 3}              # 1: ë§¨í•˜íƒ„, 2: ìœ í´ë¦¬ë“œ
    
    # ì•Œê³ ë¦¬ì¦˜ ì„ íƒ
    algorithm: {type: "categorical", choices: ["auto", "ball_tree", "kd_tree", "brute"]}
    
    # ë¦¬í”„ í¬ê¸° (íŠ¸ë¦¬ ì•Œê³ ë¦¬ì¦˜ìš©)
    leaf_size: {type: "int", low: 10, high: 50}

  # í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹ ì„¤ì •
  hyperparameter_tuning:
    enabled: true
    n_trials: 50                      # KNNì€ ë‹¨ìˆœí•˜ë¯€ë¡œ ì ì€ trial
    metric: "f1_weighted"
    direction: "maximize"
  
  # Feature Store ê¸°ë°˜ í”¼ì²˜ ì¦ê°•
  augmenter:
    type: "feature_store"
    features:
      # ì‚¬ìš©ì í–‰ë™ ë²¡í„°
      - feature_namespace: "user_behavior_vector"
        features: ["click_rate", "purchase_rate", "time_spent", "return_rate"]
      
      # ì œí’ˆ íŠ¹ì„± ë²¡í„°
      - feature_namespace: "product_feature_vector"
        features: ["price_normalized", "rating_score", "popularity_index", "category_affinity"]
      
      # ìƒí˜¸ì‘ìš© ì»¨í…ìŠ¤íŠ¸
      - feature_namespace: "interaction_context"
        features: ["session_position", "time_of_day", "device_type", "season"]
      
      # ìœ ì‚¬ë„ ê¸°ë°˜ í”¼ì²˜
      - feature_namespace: "similarity_features"
        features: ["user_similarity_avg", "product_similarity_avg", "collaborative_score"]

  # ì „ì²˜ë¦¬ ì„¤ì • (KNNì€ ìŠ¤ì¼€ì¼ë§ í•„ìˆ˜!)
  preprocessor:
    name: "classification_preprocessor"
    params:
      criterion_col: null
      exclude_cols: ["user_id", "product_category", "interaction_time", "user_preference"]
      handle_missing: "median"
      scale_features: true             # KNNì€ ê±°ë¦¬ ê¸°ë°˜ì´ë¯€ë¡œ ìŠ¤ì¼€ì¼ë§ í•„ìˆ˜
      encode_categorical: "onehot"     # One-hot encoding for distance calculation

  # í‰ê°€ì ì„¤ì •
  evaluator:
    name: "classification_evaluator"

# í‰ê°€ ì„¤ì •
evaluation:
  metrics:
    - "accuracy"
    - "precision_weighted"
    - "recall_weighted"
    - "f1_weighted"
    - "roc_auc"                        # ë‹¤ì¤‘ë¶„ë¥˜ì˜ ê²½ìš° macro-average
  
  validation:
    method: "train_test_split"
    test_size: 0.2
    stratify: true
    random_state: 42
