# Random Forest Classifier: 앙상블의 강력함
# 🌲 높은 성능과 해석 가능성의 완벽한 균형

name: "random_forest_classifier"

model:
  # Scikit-learn Random Forest Classifier 직접 동적 import
  class_path: "sklearn.ensemble.RandomForestClassifier"
  
  # Phase 1: Point-in-Time 정합성 스키마
  loader:
    name: "fraud_detection_loader"
    source_uri: "recipes/sql/loaders/transaction_fraud_features.sql"
    adapter: sql
    entity_schema:
      entity_columns: ["transaction_id", "account_id"]  # 거래-계좌 페어
      timestamp_column: "transaction_datetime"          # 거래 시점
  
  # 기존: ML 작업별 세부 설정 (Classification 전용)
  data_interface:
    task_type: "classification"
    target_column: "is_fraud"             # 사기 여부 (0: 정상, 1: 사기)
    class_weight: "balanced"              # 불균형 데이터 자동 처리
    average: "weighted"                   # 가중 평균으로 성능 평가
    
  # Dictionary 형태 하이퍼파라미터 (Random Forest 특화)
  hyperparameters:
    # 트리 개수와 구조
    n_estimators: {type: "int", low: 100, high: 800}
    max_depth: {type: "int", low: 5, high: 30}
    min_samples_split: {type: "int", low: 2, high: 20}
    min_samples_leaf: {type: "int", low: 1, high: 10}
    
    # 피처 샘플링
    max_features: {type: "categorical", choices: ["sqrt", "log2", "auto"]}
    
    # 부트스트랩과 샘플링
    bootstrap: true
    max_samples: {type: "float", low: 0.5, high: 1.0}
    
    # 고정값
    random_state: 42
    n_jobs: -1
    class_weight: "balanced"

  # 하이퍼파라미터 튜닝 설정
  hyperparameter_tuning:
    enabled: true
    n_trials: 80
    metric: "roc_auc"
    direction: "maximize"
  
  # Feature Store 기반 피처 증강
  augmenter:
    type: "feature_store"
    features:
      # 거래 패턴
      - feature_namespace: "transaction_patterns"
        features: ["amount", "transaction_type", "merchant_category", "location_country"]
      
      # 계좌 이력
      - feature_namespace: "account_history"
        features: ["account_age", "avg_monthly_volume", "transaction_frequency", "suspicious_activity_count"]
      
      # 시간적 특성
      - feature_namespace: "temporal_features"
        features: ["hour_of_day", "day_of_week", "is_holiday", "time_since_last_transaction"]
      
      # 위험 지표
      - feature_namespace: "risk_indicators"
        features: ["velocity_check", "geo_mismatch", "device_fingerprint", "ip_reputation"]

  # 전처리 설정
  preprocessor:
    name: "classification_preprocessor"
    params:
      criterion_col: null
      exclude_cols: ["transaction_id", "account_id", "transaction_datetime", "is_fraud"]
      handle_missing: "median"
      scale_features: false        # Random Forest는 스케일링 불필요
      encode_categorical: "onehot"

  # 평가자 설정
  evaluator:
    name: "classification_evaluator"

# 평가 설정
evaluation:
  metrics:
    - "accuracy"
    - "precision_weighted"
    - "recall_weighted"
    - "f1_weighted"
    - "roc_auc"
  
  validation:
    method: "train_test_split"
    test_size: 0.2
    stratify: true
    random_state: 42
