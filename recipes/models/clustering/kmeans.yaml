# K-Means: ê³ ì „ì ì´ë©´ì„œë„ ê°•ë ¥í•œ í´ëŸ¬ìŠ¤í„°ë§ ì•Œê³ ë¦¬ì¦˜
# ğŸ¯ ê³ ê° ì„¸ë¶„í™”ì™€ ì‹œì¥ ë¶„ì„ì˜ í•µì‹¬ ë„êµ¬

name: "kmeans"

model:
  # Scikit-learn K-Means ì§ì ‘ ë™ì  import
  class_path: "sklearn.cluster.KMeans"
  
  # Phase 1: Point-in-Time ì •í•©ì„± ìŠ¤í‚¤ë§ˆ
  loader:
    name: "customer_segmentation_loader"
    source_uri: "recipes/sql/loaders/customer_analytics_features.sql"
    entity_schema:
      entity_columns: ["customer_id"]        # ê³ ê° ID
      timestamp_column: "analysis_date"      # ë¶„ì„ ê¸°ì¤€ì¼
  
  # ê¸°ì¡´: ML ì‘ì—…ë³„ ì„¸ë¶€ ì„¤ì • (Clustering ì „ìš©)
  data_interface:
    task_type: "clustering"
    n_clusters: 5           # ê¸°ë³¸ í´ëŸ¬ìŠ¤í„° ìˆ˜ (ê³ ê° ì„¸ë¶„í™”: 5ê°œ ê·¸ë£¹)
    
  # Dictionary í˜•íƒœ í•˜ì´í¼íŒŒë¼ë¯¸í„° (K-Means íŠ¹í™”)
  hyperparameters:
    # í´ëŸ¬ìŠ¤í„° ìˆ˜ (ê°€ì¥ ì¤‘ìš”í•œ í•˜ì´í¼íŒŒë¼ë¯¸í„°)
    n_clusters: {type: "int", low: 3, high: 10}
    
    # ì´ˆê¸°í™” ë°©ë²•
    init: {type: "categorical", choices: ["k-means++", "random"]}
    
    # ìµœëŒ€ ë°˜ë³µ íšŸìˆ˜
    max_iter: {type: "int", low: 100, high: 500}
    
    # í—ˆìš© ì˜¤ì°¨ (ì¡°ê¸° ì¢…ë£Œ)
    tol: {type: "float", low: 1e-6, high: 1e-3, log: true}
    
    # ì´ˆê¸°í™” ì‹œë„ íšŸìˆ˜
    n_init: {type: "int", low: 5, high: 20}
    
    # ê³ ì •ê°’ - ì¬í˜„ì„±ê³¼ ì„±ëŠ¥ì„ ìœ„í•œ ì„¤ì •
    random_state: 42
    algorithm: "lloyd"      # Lloyd ì•Œê³ ë¦¬ì¦˜ (ì•ˆì •ì )

  # í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹ ì„¤ì • (Clustering ë©”íŠ¸ë¦­ ìµœì í™”)
  hyperparameter_tuning:
    enabled: true
    n_trials: 50                        # í´ëŸ¬ìŠ¤í„°ë§ì€ ë¹„êµì  ë¹ ë¦„
    metric: "silhouette_score"         # ì‹¤ë£¨ì—£ ì ìˆ˜ë¡œ ìµœì í™”
    direction: "maximize"
  
  # Feature Store ê¸°ë°˜ í”¼ì²˜ ì¦ê°•
  augmenter:
    type: "feature_store"
    features:
      # ê³ ê° ì¸êµ¬í†µê³„í•™ì  ì •ë³´
      - feature_namespace: "customer_demographics"
        features: ["age", "income", "education_level", "family_size"]
      
      # êµ¬ë§¤ í–‰ë™ íŒ¨í„´
      - feature_namespace: "purchase_behavior"
        features: ["total_spent_12m", "purchase_frequency", "avg_order_value", "preferred_category"]
      
      # ë””ì§€í„¸ í™œë™
      - feature_namespace: "digital_engagement"
        features: ["website_visits", "email_open_rate", "social_media_activity"]
      
      # ë§Œì¡±ë„ ë° ì¶©ì„±ë„
      - feature_namespace: "loyalty_metrics"
        features: ["nps_score", "churn_probability", "lifetime_value", "referral_count"]

  # ì „ì²˜ë¦¬ ì„¤ì • (K-Means íŠ¹í™”)
  preprocessor:
    name: "clustering_preprocessor"
    params:
      criterion_col: null
      # Entity í‚¤, timestampëŠ” ì „ì²˜ë¦¬ì—ì„œ ì œì™¸ (clusteringì€ target ì—†ìŒ)
      exclude_cols: ["customer_id", "analysis_date"]
      # K-Meansë¥¼ ìœ„í•œ íŠ¹ë³„ ì„¤ì •
      handle_missing: "mean"            # ê²°ì¸¡ì¹˜ë¥¼ í‰ê· ìœ¼ë¡œ ì²˜ë¦¬
      scale_features: true              # í‘œì¤€í™” (K-Meansì— í•„ìˆ˜!)
      encode_categorical: "onehot"      # ë²”ì£¼í˜• ì›í•« ì¸ì½”ë”©
      remove_outliers: true             # ì´ìƒì¹˜ ì œê±° (í´ëŸ¬ìŠ¤í„°ë§ì— ì¤‘ìš”)
      feature_selection: true           # ìƒê´€ê´€ê³„ ë†’ì€ í”¼ì²˜ ì œê±°

  # í‰ê°€ì ì„¤ì •
  evaluator:
    name: "clustering_evaluator"

# í‰ê°€ ì„¤ì • (Clustering íŠ¹í™” ë©”íŠ¸ë¦­)
evaluation:
  metrics:
    - "silhouette_score"           # ì‹¤ë£¨ì—£ ì ìˆ˜ (í´ëŸ¬ìŠ¤í„° í’ˆì§ˆ)
    - "calinski_harabasz_score"    # Calinski-Harabasz ì§€ìˆ˜
    - "davies_bouldin_score"       # Davies-Bouldin ì§€ìˆ˜
    - "inertia"                    # í´ëŸ¬ìŠ¤í„° ë‚´ ì œê³±í•©
  
  validation:
    method: "unsupervised"         # ë¹„ì§€ë„ í•™ìŠµ (train/test split ë¶ˆí•„ìš”)
    random_state: 42
