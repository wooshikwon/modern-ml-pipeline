# Hierarchical Clustering: ê³„ì¸µì  êµ¬ì¡°ì˜ ì™„ë²½í•œ ë°œê²¬
# ğŸŒ³ ë´ë“œë¡œê·¸ë¨ìœ¼ë¡œ ë°ì´í„°ì˜ ìì—°ìŠ¤ëŸ¬ìš´ ê³„ì¸µ êµ¬ì¡°ë¥¼ ì‹œê°í™”

name: "hierarchical_clustering"

model:
  # Scikit-learn Agglomerative Clustering ì§ì ‘ ë™ì  import
  class_path: "sklearn.cluster.AgglomerativeClustering"
  
  # Phase 1: Point-in-Time ì •í•©ì„± ìŠ¤í‚¤ë§ˆ
  loader:
    name: "market_segmentation_loader"
    source_uri: "recipes/sql/loaders/market_segmentation_features.sql"
    entity_schema:
      entity_columns: ["company_id", "industry_sector"]    # íšŒì‚¬-ì‚°ì—…ì„¹í„° í˜ì–´
      timestamp_column: "analysis_quarter"                 # ë¶„ì„ ë¶„ê¸°
  
  # ê¸°ì¡´: ML ì‘ì—…ë³„ ì„¸ë¶€ ì„¤ì • (Clustering ì „ìš©)
  data_interface:
    task_type: "clustering"
    n_clusters: 5                       # ì´ˆê¸° í´ëŸ¬ìŠ¤í„° ìˆ˜ (ì¡°ì • ê°€ëŠ¥)
    
  # Dictionary í˜•íƒœ í•˜ì´í¼íŒŒë¼ë¯¸í„° (Hierarchical íŠ¹í™”)
  hyperparameters:
    # í´ëŸ¬ìŠ¤í„° ìˆ˜ (Hierarchicalì˜ í•µì‹¬)
    n_clusters: {type: "int", low: 2, high: 15}
    
    # ì—°ê²° ë°©ë²• (Linkage Criteria)
    linkage: {type: "categorical", choices: ["ward", "complete", "average", "single"]}
    
    # ê±°ë¦¬ ë©”íŠ¸ë¦­
    metric: {type: "categorical", choices: ["euclidean", "manhattan", "cosine"]}
    
    # ì—°ê²°ì„± ì œì•½ (ì„ íƒì )
    connectivity: null

  # í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹ ì„¤ì •
  hyperparameter_tuning:
    enabled: true
    n_trials: 50                      # ê³„ì¸µì  í´ëŸ¬ìŠ¤í„°ë§ì€ ì ë‹¹í•œ trial
    metric: "silhouette_score"
    direction: "maximize"
  
  # Feature Store ê¸°ë°˜ í”¼ì²˜ ì¦ê°•
  augmenter:
    type: "feature_store"
    features:
      # ì¬ë¬´ ì„±ê³¼ ì§€í‘œ
      - feature_namespace: "financial_performance"
        features: ["revenue_growth", "profit_margin", "roe", "debt_ratio", "cash_flow"]
      
      # ì‹œì¥ í¬ì§€ì…˜
      - feature_namespace: "market_position"
        features: ["market_share", "competitive_advantage", "brand_value", "customer_loyalty", "innovation_index"]
      
      # ìš´ì˜ íš¨ìœ¨ì„±
      - feature_namespace: "operational_efficiency"
        features: ["asset_turnover", "productivity_index", "cost_efficiency", "supply_chain_score"]
      
      # ESG ì§€í‘œ
      - feature_namespace: "esg_factors"
        features: ["environmental_score", "social_responsibility", "governance_quality", "sustainability_index"]

  # ì „ì²˜ë¦¬ ì„¤ì • (Hierarchicalì€ ìŠ¤ì¼€ì¼ë§ ì¤‘ìš”!)
  preprocessor:
    name: "clustering_preprocessor"
    params:
      criterion_col: null
      exclude_cols: ["company_id", "industry_sector", "analysis_quarter"]
      handle_missing: "median"
      scale_features: true             # ê³„ì¸µì  í´ëŸ¬ìŠ¤í„°ë§ì€ ê±°ë¦¬ ê¸°ë°˜ì´ë¯€ë¡œ ìŠ¤ì¼€ì¼ë§ í•„ìˆ˜
      encode_categorical: "onehot"

  # í‰ê°€ì ì„¤ì •
  evaluator:
    name: "clustering_evaluator"

# í‰ê°€ ì„¤ì •
evaluation:
  metrics:
    - "silhouette_score"
    - "calinski_harabasz_score"
    - "davies_bouldin_score"
    - "adjusted_rand_score"
  
  validation:
    method: "clustering_validation"
    random_state: 42
