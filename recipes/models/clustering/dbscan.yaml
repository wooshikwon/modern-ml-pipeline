# DBSCAN: ë°€ë„ ê¸°ë°˜ í´ëŸ¬ìŠ¤í„°ë§ì˜ í˜ì‹ 
# ğŸ” ë…¸ì´ì¦ˆë¥¼ ìë™ìœ¼ë¡œ íƒì§€í•˜ë©° ì„ì˜ ëª¨ì–‘ì˜ í´ëŸ¬ìŠ¤í„°ë¥¼ ë°œê²¬

name: "dbscan"

model:
  # Scikit-learn DBSCAN ì§ì ‘ ë™ì  import
  class_path: "sklearn.cluster.DBSCAN"
  
  # Phase 1: ë°ì´í„° ë¡œë”© ì„¤ì • (ì—”í‹°í‹° ìŠ¤í‚¤ë§ˆ í¬í•¨)
  loader:
    name: "anomaly_detection_loader"
    source_uri: "data/sensor_data_for_anomaly.csv"
    adapter: storage
    entity_schema:
      entity_columns: ["sensor_id", "timestamp"]
      timestamp_column: "timestamp"
  
  # ê¸°ì¡´: ML ì‘ì—…ë³„ ì„¸ë¶€ ì„¤ì • (Clustering ì „ìš©)
  data_interface:
    task_type: "clustering"
    n_clusters: null                    # DBSCANì€ í´ëŸ¬ìŠ¤í„° ìˆ˜ë¥¼ ìë™ ê²°ì •
    
  # Dictionary í˜•íƒœ í•˜ì´í¼íŒŒë¼ë¯¸í„° (DBSCAN íŠ¹í™”)
  hyperparameters:
    # ë°€ë„ íŒŒë¼ë¯¸í„° (DBSCANì˜ í•µì‹¬)
    eps: {type: "float", low: 0.1, high: 2.0}              # ì´ì›ƒ ê±°ë¦¬ ì„ê³„ê°’
    min_samples: {type: "int", low: 3, high: 20}           # í•µì‹¬ì  ìµœì†Œ ì´ì›ƒ ìˆ˜
    
    # ê±°ë¦¬ ê³„ì‚° ë°©ë²•
    metric: {type: "categorical", choices: ["euclidean", "manhattan", "cosine"]}
    
    # ì•Œê³ ë¦¬ì¦˜ ì„ íƒ
    algorithm: {type: "categorical", choices: ["auto", "ball_tree", "kd_tree", "brute"]}
    
    # ë¦¬í”„ í¬ê¸° (íŠ¸ë¦¬ ì•Œê³ ë¦¬ì¦˜ìš©)
    leaf_size: {type: "int", low: 10, high: 50}
    
    # ë³‘ë ¬ ì²˜ë¦¬
    n_jobs: -1

  # í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹ ì„¤ì •
  hyperparameter_tuning:
    enabled: true
    n_trials: 40                      # DBSCANì€ ìƒëŒ€ì ìœ¼ë¡œ ì ì€ trial
    metric: "silhouette_score"        # ì‹¤ë£¨ì—£ ìŠ¤ì½”ì–´ë¡œ í‰ê°€
    direction: "maximize"
  
  # Feature Store ê¸°ë°˜ í”¼ì²˜ ì¦ê°•
  augmenter:
    type: "feature_store"
    features:
      # êµ¬ë§¤ í–‰ë™ íŒ¨í„´
      - feature_namespace: "purchase_behavior"
        features: ["purchase_frequency", "avg_order_value", "recency_days", "monetary_total"]
      
      # ë¸Œë¼ìš°ì§• íŒ¨í„´
      - feature_namespace: "browsing_patterns"
        features: ["page_views_per_session", "session_duration", "bounce_rate", "device_preference"]
      
      # ì œí’ˆ ì„ í˜¸ë„
      - feature_namespace: "product_preferences"
        features: ["category_diversity", "brand_loyalty", "price_sensitivity", "seasonal_patterns"]
      
      # ì°¸ì—¬ë„ ì§€í‘œ
      - feature_namespace: "engagement_metrics"
        features: ["email_open_rate", "social_interaction", "review_activity", "referral_behavior"]

  # ì „ì²˜ë¦¬ ì„¤ì • (DBSCANì€ ìŠ¤ì¼€ì¼ë§ ì¤‘ìš”!)
  preprocessor:
    name: "clustering_preprocessor"
    params:
      criterion_col: null
      exclude_cols: ["customer_id", "behavior_period", "analysis_date"]
      handle_missing: "median"
      scale_features: true             # DBSCANì€ ê±°ë¦¬ ê¸°ë°˜ì´ë¯€ë¡œ ìŠ¤ì¼€ì¼ë§ í•„ìˆ˜
      encode_categorical: "onehot"

  # í‰ê°€ì ì„¤ì •
  evaluator:
    name: "clustering_evaluator"

# í‰ê°€ ì„¤ì •
evaluation:
  metrics:
    - "silhouette_score"
    - "calinski_harabasz_score"
    - "davies_bouldin_score"
    - "adjusted_rand_score"           # ì™¸ë¶€ í‰ê°€ ì§€í‘œ
  
  validation:
    method: "clustering_validation"   # í´ëŸ¬ìŠ¤í„°ë§ ì „ìš© ê²€ì¦
    random_state: 42
