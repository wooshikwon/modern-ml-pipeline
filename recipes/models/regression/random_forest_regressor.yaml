# Random Forest Regressor: ì•™ìƒë¸”ì˜ ì•ˆì •ì ì¸ í˜
# ğŸŒ² ë‹¤ìˆ˜ì˜ íŠ¸ë¦¬ê°€ ë§Œë“œëŠ” ê°•ë ¥í•˜ê³  ì•ˆì •ì ì¸ ì˜ˆì¸¡

name: "random_forest_regressor"

model:
  # Scikit-learn Random Forest Regressor ì§ì ‘ ë™ì  import
  class_path: "sklearn.ensemble.RandomForestRegressor"
  
  # Phase 1: Point-in-Time ì •í•©ì„± ìŠ¤í‚¤ë§ˆ
  loader:
    name: "bike_sharing_demand_loader"
    source_uri: "recipes/sql/loaders/bike_sharing_features.sql"
    adapter: sql
    entity_schema:
      entity_columns: ["datetime"]
      timestamp_column: "datetime"
  
  # ê¸°ì¡´: ML ì‘ì—…ë³„ ì„¸ë¶€ ì„¤ì • (Regression ì „ìš©)
  data_interface:
    task_type: "regression"
    target_column: "next_day_return"           # ë‹¤ìŒë‚  ìˆ˜ìµë¥  (ì—°ì†í˜•)
    
  # Dictionary í˜•íƒœ í•˜ì´í¼íŒŒë¼ë¯¸í„° (Random Forest íŠ¹í™”)
  hyperparameters:
    # íŠ¸ë¦¬ ê°œìˆ˜ì™€ êµ¬ì¡°
    n_estimators: {type: "int", low: 100, high: 800}
    max_depth: {type: "int", low: 5, high: 30}
    min_samples_split: {type: "int", low: 2, high: 20}
    min_samples_leaf: {type: "int", low: 1, high: 10}
    
    # í”¼ì²˜ ìƒ˜í”Œë§
    max_features: {type: "categorical", choices: ["sqrt", "log2", "auto"]}
    
    # ë¶€íŠ¸ìŠ¤íŠ¸ë©ê³¼ ìƒ˜í”Œë§
    bootstrap: true
    max_samples: {type: "float", low: 0.5, high: 1.0}
    
    # ê³ ì •ê°’
    random_state: 42
    n_jobs: -1

  # í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹ ì„¤ì •
  hyperparameter_tuning:
    enabled: true
    n_trials: 80
    metric: "neg_mean_squared_error"
    direction: "maximize"
  
  # Feature Store ê¸°ë°˜ í”¼ì²˜ ì¦ê°•
  augmenter:
    type: "feature_store"
    features:
      # ê¸°ìˆ ì  ì§€í‘œ
      - feature_namespace: "technical_indicators"
        features: ["rsi", "macd", "bollinger_bands", "moving_average_20", "volume_sma"]
      
      # ì‹œì¥ ì •ë³´
      - feature_namespace: "market_data"
        features: ["market_cap", "pe_ratio", "volatility", "beta", "sector_performance"]
      
      # ê±°ì‹œê²½ì œ ì§€í‘œ
      - feature_namespace: "macroeconomic_indicators"
        features: ["interest_rate", "inflation", "gdp_growth", "unemployment", "currency_index"]
      
      # ê°ì • ì§€í‘œ
      - feature_namespace: "sentiment_indicators"
        features: ["vix_index", "put_call_ratio", "insider_trading", "analyst_ratings"]

  # ì „ì²˜ë¦¬ ì„¤ì •
  preprocessor:
    name: "regression_preprocessor"
    params:
      criterion_col: null
      exclude_cols: ["stock_symbol", "exchange_id", "trading_date", "next_day_return"]
      handle_missing: "median"
      scale_features: false        # Random ForestëŠ” ìŠ¤ì¼€ì¼ë§ ë¶ˆí•„ìš”
      encode_categorical: "onehot"

  # í‰ê°€ì ì„¤ì •
  evaluator:
    name: "regression_evaluator"

# í‰ê°€ ì„¤ì •
evaluation:
  metrics:
    - "r2_score"
    - "mean_absolute_error"
    - "mean_squared_error"
    - "root_mean_squared_error"
  
  validation:
    method: "train_test_split"
    test_size: 0.2
    random_state: 42
