# Random Forest Regressor: 앙상블의 안정적인 힘
# 🌲 다수의 트리가 만드는 강력하고 안정적인 예측

name: "random_forest_regressor"

model:
  # Scikit-learn Random Forest Regressor 직접 동적 import
  class_path: "sklearn.ensemble.RandomForestRegressor"
  
  # Phase 1: Point-in-Time 정합성 스키마
  loader:
    name: "bike_sharing_demand_loader"
    source_uri: "recipes/sql/loaders/bike_sharing_features.sql"
    adapter: sql
    entity_schema:
      entity_columns: ["datetime"]
      timestamp_column: "datetime"
  
  # 기존: ML 작업별 세부 설정 (Regression 전용)
  data_interface:
    task_type: "regression"
    target_column: "next_day_return"           # 다음날 수익률 (연속형)
    
  # Dictionary 형태 하이퍼파라미터 (Random Forest 특화)
  hyperparameters:
    # 트리 개수와 구조
    n_estimators: {type: "int", low: 100, high: 800}
    max_depth: {type: "int", low: 5, high: 30}
    min_samples_split: {type: "int", low: 2, high: 20}
    min_samples_leaf: {type: "int", low: 1, high: 10}
    
    # 피처 샘플링
    max_features: {type: "categorical", choices: ["sqrt", "log2", "auto"]}
    
    # 부트스트랩과 샘플링
    bootstrap: true
    max_samples: {type: "float", low: 0.5, high: 1.0}
    
    # 고정값
    random_state: 42
    n_jobs: -1

  # 하이퍼파라미터 튜닝 설정
  hyperparameter_tuning:
    enabled: true
    n_trials: 80
    metric: "neg_mean_squared_error"
    direction: "maximize"
  
  # Feature Store 기반 피처 증강
  augmenter:
    type: "feature_store"
    features:
      # 기술적 지표
      - feature_namespace: "technical_indicators"
        features: ["rsi", "macd", "bollinger_bands", "moving_average_20", "volume_sma"]
      
      # 시장 정보
      - feature_namespace: "market_data"
        features: ["market_cap", "pe_ratio", "volatility", "beta", "sector_performance"]
      
      # 거시경제 지표
      - feature_namespace: "macroeconomic_indicators"
        features: ["interest_rate", "inflation", "gdp_growth", "unemployment", "currency_index"]
      
      # 감정 지표
      - feature_namespace: "sentiment_indicators"
        features: ["vix_index", "put_call_ratio", "insider_trading", "analyst_ratings"]

  # 전처리 설정
  preprocessor:
    name: "regression_preprocessor"
    params:
      criterion_col: null
      exclude_cols: ["stock_symbol", "exchange_id", "trading_date", "next_day_return"]
      handle_missing: "median"
      scale_features: false        # Random Forest는 스케일링 불필요
      encode_categorical: "onehot"

  # 평가자 설정
  evaluator:
    name: "regression_evaluator"

# 평가 설정
evaluation:
  metrics:
    - "r2_score"
    - "mean_absolute_error"
    - "mean_squared_error"
    - "root_mean_squared_error"
  
  validation:
    method: "train_test_split"
    test_size: 0.2
    random_state: 42
