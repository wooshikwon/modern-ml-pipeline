# Elastic Net: Ridge와 Lasso의 완벽한 조합
# ⚖️ L1과 L2 정규화를 균형있게 조합한 최적의 회귀

name: "elastic_net"

model:
  # Scikit-learn Elastic Net 직접 동적 import
  class_path: "sklearn.linear_model.ElasticNet"
  
  # Phase 1: Point-in-Time 정합성 스키마
  loader:
    name: "real_estate_price_loader"
    source_uri: "recipes/sql/loaders/real_estate_features.sql"
    adapter: sql
    entity_schema:
      entity_columns: ["property_id"]
      timestamp_column: "sale_date"
  
  # 기존: ML 작업별 세부 설정 (Regression 전용)
  data_interface:
    task_type: "regression"
    target_column: "weekly_sales_units"        # 주간 판매량 (연속형)
    
  # Dictionary 형태 하이퍼파라미터 (Elastic Net 특화)
  hyperparameters:
    # 정규화 강도 (전체)
    alpha: {type: "float", low: 0.001, high: 10.0, log: true}
    
    # L1과 L2 비율 조정 (Elastic Net의 핵심)
    l1_ratio: {type: "float", low: 0.1, high: 0.9}    # 0: Ridge, 1: Lasso
    
    # 최대 반복 횟수
    max_iter: {type: "int", low: 1000, high: 5000}
    
    # 수렴 허용 오차
    tol: {type: "float", low: 1e-5, high: 1e-3, log: true}
    
    # 양수 제약 (판매량은 양수)
    positive: true
    
    # 고정값
    random_state: 42
    fit_intercept: true

  # 하이퍼파라미터 튜닝 설정
  hyperparameter_tuning:
    enabled: true
    n_trials: 60                      # Elastic Net은 두 정규화를 조합하므로 더 많은 trial
    metric: "neg_mean_absolute_percentage_error"
    direction: "maximize"
  
  # Feature Store 기반 피처 증강
  augmenter:
    type: "feature_store"
    features:
      # 제품 특성
      - feature_namespace: "product_characteristics"
        features: ["price", "category", "brand", "seasonal_factor", "promotion_sensitivity"]
      
      # 매장 특성
      - feature_namespace: "store_characteristics"
        features: ["store_size", "location_type", "foot_traffic", "competitor_density", "demographics"]
      
      # 시간적 트렌드
      - feature_namespace: "temporal_trends"
        features: ["week_of_year", "month", "holiday_proximity", "weather_index", "economic_indicator"]
      
      # 마케팅 활동
      - feature_namespace: "marketing_activities"
        features: ["advertising_spend", "promotion_active", "discount_percentage", "social_media_engagement"]

  # 전처리 설정 (Elastic Net은 스케일링 필요)
  preprocessor:
    name: "regression_preprocessor"
    params:
      criterion_col: null
      exclude_cols: ["product_id", "store_id", "forecast_date", "weekly_sales_units"]
      handle_missing: "median"
      scale_features: true             # Elastic Net은 스케일링 필요
      encode_categorical: "onehot"

  # 평가자 설정
  evaluator:
    name: "regression_evaluator"

# 평가 설정
evaluation:
  metrics:
    - "r2_score"
    - "mean_absolute_error"
    - "mean_squared_error"
    - "root_mean_squared_error"
  
  validation:
    method: "train_test_split"
    test_size: 0.2
    random_state: 42
