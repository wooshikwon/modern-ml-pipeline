# Recipe Example: ì™„ë²½í•œ ML Pipeline ì„¤ì • ê°€ì´ë“œ
# ğŸ“š ëª¨ë“  Recipeì˜ ëª¨ë²”ì´ ë˜ëŠ” ì™„ì „í•œ êµ¬ì¡° ì˜ˆì‹œ

name: "recipe_example"

model:
  # ML ëª¨ë¸ í´ë˜ìŠ¤ ê²½ë¡œ (ë™ì  import)
  class_path: "sklearn.ensemble.RandomForestClassifier"
  
  # Phase 1: Point-in-Time ì •í•©ì„± ìŠ¤í‚¤ë§ˆ
  loader:
    name: "comprehensive_ml_loader"
    source_uri: "recipes/sql/loaders/comprehensive_features.sql"
    entity_schema:
      entity_columns: ["user_id", "product_id", "session_id"]  # Primary Key ì¡°í•©
      timestamp_column: "event_timestamp"                      # Point-in-Time ê¸°ì¤€
  
  # ê¸°ì¡´: ML ì‘ì—…ë³„ ì„¸ë¶€ ì„¤ì • (ì™„ì „íˆ ë³´ì¡´)
  data_interface:
    task_type: "classification"
    target_column: "purchase_decision"    # íƒ€ê²Ÿ ë³€ìˆ˜
    class_weight: "balanced"              # í´ë˜ìŠ¤ ë¶ˆê· í˜• ì²˜ë¦¬
    average: "weighted"                   # ë‹¤ì¤‘ë¶„ë¥˜ í‰ê°€ ë°©ì‹
    
  # Dictionary í˜•íƒœ í•˜ì´í¼íŒŒë¼ë¯¸í„° (Optuna í˜¸í™˜)
  hyperparameters:
    # íŠ¸ë¦¬ êµ¬ì¡° íŒŒë¼ë¯¸í„°
    n_estimators: {type: "int", low: 50, high: 500}
    max_depth: {type: "int", low: 3, high: 20}
    min_samples_split: {type: "int", low: 2, high: 20}
    min_samples_leaf: {type: "int", low: 1, high: 10}
    
    # í”¼ì²˜ ìƒ˜í”Œë§
    max_features: {type: "categorical", choices: ["sqrt", "log2", "auto"]}
    
    # ë¶„í•  ê¸°ì¤€
    criterion: {type: "categorical", choices: ["gini", "entropy"]}
    
    # ê³ ì •ê°’
    random_state: 42
    n_jobs: -1
    class_weight: "balanced"

  # í•˜ì´í¼íŒŒë¼ë¯¸í„° ìë™ ìµœì í™” ì„¤ì •
  hyperparameter_tuning:
    enabled: true
    n_trials: 100                     # Optuna ì‹œí–‰ íšŸìˆ˜
    metric: "f1_weighted"            # ìµœì í™” ëª©í‘œ ë©”íŠ¸ë¦­
    direction: "maximize"            # ìµœì í™” ë°©í–¥
  
  # Feature Store ê¸°ë°˜ í”¼ì²˜ ì¦ê°•
  augmenter:
    type: "feature_store"
    features:
      # ì‚¬ìš©ì ì¸êµ¬í†µê³„í•™ì  íŠ¹ì„±
      - feature_namespace: "user_demographics"
        features: ["age", "gender", "location", "education_level", "income_bracket"]
      
      # ì‚¬ìš©ì êµ¬ë§¤ ì´ë ¥
      - feature_namespace: "user_purchase_summary"
        features: ["ltv", "total_purchase_count", "avg_order_value", "last_purchase_date"]
      
      # ì œí’ˆ ì •ë³´
      - feature_namespace: "product_details"
        features: ["price", "category", "brand", "rating", "popularity_score"]
      
      # ì„¸ì…˜ í–‰ë™ ë°ì´í„°
      - feature_namespace: "session_summary"
        features: ["time_on_page_seconds", "click_count", "page_views", "bounce_rate"]
      
      # ì‹¤ì‹œê°„ ì»¨í…ìŠ¤íŠ¸
      - feature_namespace: "contextual_features"
        features: ["time_of_day", "device_type", "referral_source", "campaign_id"]

  # ë°ì´í„° ì „ì²˜ë¦¬ ì„¤ì •
  preprocessor:
    name: "classification_preprocessor"
    params:
      criterion_col: null
      exclude_cols: ["user_id", "product_id", "session_id", "event_timestamp", "purchase_decision"]
      handle_missing: "median"        # ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ë°©ì‹
      scale_features: false           # Random ForestëŠ” ìŠ¤ì¼€ì¼ë§ ë¶ˆí•„ìš”
      encode_categorical: "onehot"    # ë²”ì£¼í˜• ë³€ìˆ˜ ì¸ì½”ë”©

  # í‰ê°€ì ì„¤ì •
  evaluator:
    name: "classification_evaluator"

# ëª¨ë¸ í‰ê°€ ì„¤ì •
evaluation:
  metrics:
    - "accuracy"              # ì •í™•ë„
    - "precision_weighted"    # ê°€ì¤‘ ì •ë°€ë„
    - "recall_weighted"       # ê°€ì¤‘ ì¬í˜„ìœ¨
    - "f1_weighted"          # ê°€ì¤‘ F1-Score
    - "roc_auc"              # ROC AUC
  
  validation:
    method: "train_test_split"
    test_size: 0.2
    stratify: true            # íƒ€ê²Ÿ ë¶„í¬ ìœ ì§€
    random_state: 42

# ì¶”ê°€ ë©”íƒ€ë°ì´í„° (ì„ íƒì )
metadata:
  description: "ì™„ë²½í•œ ML Pipeline ì„¤ì •ì„ ë³´ì—¬ì£¼ëŠ” ì¢…í•© ì˜ˆì‹œ"
  use_cases:
    - "êµ¬ë§¤ ì˜ë„ ì˜ˆì¸¡"
    - "ê³ ê° ì„¸ë¶„í™”"
    - "ê°œì¸í™” ì¶”ì²œ"
  performance_baseline:
    target_metric: "f1_weighted"
    minimum_score: 0.75
  data_requirements:
    minimum_samples: 10000
    feature_count: "20+"
    time_range: "6ê°œì›” ì´ìƒ"
