# recipes/xgboost_x_learner.yaml
# XGBoost X-Learner ëª¨ë¸ì„ ìœ„í•œ ëª¨ë“  ì •ì˜ê°€ í¬í•¨ëœ "ì˜¬ì¸ì›" ë ˆì‹œí”¼
# ğŸ†• Blueprint v17.0 í˜¸í™˜: Dictionary í˜•ì‹ hyperparameters + ìë™ íŠœë‹ ì§€ì›

# 1. ëª¨ë¸ ê¸°ë³¸ ì •ë³´
class_path: "causalml.inference.meta.XGBTRegressor"

# 2. ë°ì´í„° ë¡œë” ì •ì˜
loader:
  name: "campaign_users"
  # ê¸°ë³¸ ì†ŒìŠ¤: bq ìŠ¤í‚´ì„ ì‚¬ìš©í•˜ì—¬ BigQuery SQL íŒŒì¼ì„ì„ ëª…ì‹œ
  source_uri: "bq://recipes/sql/loader/user_features.sql"
  # ë¡œì»¬ ì¬ì •ì˜: file ìŠ¤í‚´ì„ ì‚¬ìš©í•˜ì—¬ ë¡œì»¬ íŒŒì¼ì„ì„ ëª…ì‹œ
  local_override_uri: "file://local/data/sample_user_features.csv"

# 3. í”¼ì²˜ ì¦ê°•ê¸° ì •ì˜ (ğŸ†• Blueprint v17.0 - Feature Store ë°©ì‹)
augmenter:
  # ğŸ†• ì„ ì–¸ì  Feature Store ë°©ì‹ (Blueprint v17.0)
  type: "feature_store"  # í™˜ê²½ë³„ Feature Store ì‚¬ìš© ëª…ì‹œ
  features:
    # user_id(member_id) ì—”í‹°í‹°ì— ê²°í•©í•  í”¼ì²˜ ëª©ë¡
    - feature_namespace: "user_demographics"
      features: ["gender", "age_group"]
    - feature_namespace: "user_behavior_summary"
      features: ["days_since_last_visit", "lifetime_purchase_count"]
    - feature_namespace: "user_purchase_summary_90d"
      features: ["avg_purchase_amount_90d"]
    - feature_namespace: "user_session_summary_30d" 
      features: ["avg_session_duration_30d"]

  # ğŸ’¾ ê¸°ì¡´ ë°©ì‹ í˜¸í™˜ì„± (í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€ - ì£¼ì„ ì²˜ë¦¬ë¨)
  # name: "point_in_time_features"
  # source_uri: "bq://recipes/sql/features/user_summary.sql"
  # local_override_uri: "file://local/data/sample_user_features.parquet"

# 4. ì „ì²˜ë¦¬ê¸° ì •ì˜
preprocessor:
  name: "simple_scaler"
  params:
    criterion_col: null
    exclude_cols: ["member_id", "event_timestamp"]

# 5. ëª¨ë¸ ì¸í„°í˜ì´ìŠ¤
data_interface:
  # Task type ì§€ì • (causal inference/uplift modeling)
  task_type: "causal"
  
  # ëª¨ë¸ì´ ê¸°ëŒ€í•˜ëŠ” ìµœì¢… í”¼ì²˜ì˜ ìŠ¤í‚¤ë§ˆ (ì´ë¦„: íƒ€ì…)
  features:
    gender: "category"
    age_group: "category"
    days_since_last_visit: "numeric"
    lifetime_purchase_count: "numeric"
    avg_purchase_amount_90d: "numeric"
    avg_session_duration_30d: "numeric"
  
  target_col: "outcome"
  treatment_col: "grp"
  treatment_value: "treatment"

# ğŸ†• 6. í•˜ì´í¼íŒŒë¼ë¯¸í„° (Blueprint v17.0 - Dictionary í˜•ì‹ + ê³ ì •ê°’ í˜¼í•©)
hyperparameters:
  # ğŸ”¥ Dictionary í˜•ì‹: Optuna ìë™ íƒìƒ‰ ë²”ìœ„ ì •ì˜
  learning_rate: {type: "float", low: 0.01, high: 0.3, log: true}
  n_estimators: {type: "int", low: 50, high: 1000}
  max_depth: {type: "int", low: 3, high: 10}
  subsample: {type: "float", low: 0.5, high: 1.0}
  colsample_bytree: {type: "float", low: 0.5, high: 1.0}
  min_child_weight: {type: "int", low: 1, high: 10}
  gamma: {type: "float", low: 0.0, high: 1.0}
  
  # ğŸ”§ ê³ ì •ê°’: ë³€ê²½í•˜ì§€ ì•Šì„ í•˜ì´í¼íŒŒë¼ë¯¸í„°
  random_state: 42
  objective: "reg:squarederror"
  eval_metric: "rmse"

# ğŸ†• 7. í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹ ì„¤ì • (Optional - ì‹¤í—˜ ë…¼ë¦¬)
hyperparameter_tuning:
  enabled: true          # ì´ ì‹¤í—˜ì—ì„œëŠ” ìë™ ìµœì í™” í™œì„±í™”
  n_trials: 50           # "ì´ ì‹¤í—˜ì€ 50ë²ˆ ì‹œë„í•  ê°€ì¹˜ê°€ ìˆë‹¤"
  metric: "roc_auc"      # "ì´ ì§€í‘œë¡œ ìµœì í™”í•œë‹¤"
  direction: "maximize"  # "ë†’ì„ìˆ˜ë¡ ì¢‹ë‹¤"
